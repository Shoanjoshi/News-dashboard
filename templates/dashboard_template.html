
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Daily News Dashboard - {{ run_date }}</title>

    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            height: 96vh;
            background-color: #fafafa;
        }

        .panel {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 18px;
            background: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
        }

        h2 {
            margin: 0 0 12px;
            font-size: 20px;
            color: #1e2a35;
        }

        .topic-map-container {
            flex: 1;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .scrollable {
            flex: 1;
            overflow-y: auto;
            border-top: 1px solid #eee;
            padding-top: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            vertical-align: top;
        }

        .new-topic { background:#fff3cd; }
        .persistent-topic { background:#d4edda; }

        .topic-col { width: 8%; text-align:center; }
        .count-col { width: 10%; text-align:center; }
        .title-col { width: 22%; }
        .summary-col { width: 60%; }

        /* dropdown */
        .toggle-container { margin-bottom: 10px; }
        select { padding: 6px; }
    </style>

    <script>
        function switchThemeView() {
            const mode = document.getElementById("theme_mode").value;
            document.getElementById("theme_scatter").style.display =
                (mode === "scatter") ? "block" : "none";
            document.getElementById("theme_table").style.display =
                (mode === "table") ? "block" : "none";
        }
    </script>
</head>

<body>

    <!-- TOP LEFT ‚Äî TOPIC MAP -->
    <div class="panel">
        <h2>üó∫ Topic Map</h2>
        <div class="topic-map-container">
            {{ topic_map | safe }}
        </div>
    </div>

    <!-- TOP RIGHT ‚Äî THEMES -->
    <div class="panel">
        <h2>üéØ Theme Signals & Distance Map</h2>

        <div class="toggle-container">
            <label><b>View:</b></label>
            <select id="theme_mode" onchange="switchThemeView()">
                <option value="scatter">Theme Scatter Plot</option>
                <option value="table">Theme Metrics Table</option>
            </select>
        </div>

        <div id="theme_scatter" style="flex:1;">
            {{ theme_map | safe }}
        </div>

        <div id="theme_table" class="scrollable" style="display:none;">
            <table>
                <thead>
                    <tr>
                        <th>Theme</th>
                        <th>Centrality<br>(Rank)</th>
                        <th>Topicality<br>(Rank)</th>
                        <th>Prior Centrality</th>
                        <th>Prior Topicality</th>
                    </tr>
                </thead>
                <tbody>
                {% for theme, data in theme_signals.items() %}
                    <tr>
                        <td>{{ theme }}</td>
                        <td>{{ data.centrality_rank }} ({{ data.centrality }})</td>
                        <td>{{ data.topicality_rank }} ({{ data.topicality }})</td>
                        <td>{{ data.prev_centrality_rank }} ({{ data.prev_centrality }})</td>
                        <td>{{ data.prev_topicality_rank }} ({{ data.prev_topicality }})</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- BOTTOM LEFT ‚Äî TOPIC SUMMARIES -->
    <div class="panel">
        <h2>üìù Topic Summaries ‚Äì {{ run_date }}</h2>
        <div class="scrollable">
            <table>
                <thead>
                    <tr>
                        <th class="topic-col">ID</th>
                        <th class="count-col">Articles</th>
                        <th class="title-col">Title</th>
                        <th class="summary-col">Summary</th>
                    </tr>
                </thead>
                <tbody>
                {% for item in summaries %}
                    <tr class="{% if item.is_new %}new-topic{% elif item.is_persistent %}persistent-topic{% endif %}">
                        <td>{{ item.topic_id }}</td>
                        <td>{{ item.article_count }}</td>
                        <td>{{ item.title }}</td>
                        <td>{{ item.summary | safe }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- BOTTOM RIGHT ‚Äî HEATMAP -->
    <div class="panel">
        <h2>üî• Topic √ó Theme Heatmap</h2>
        <div class="scrollable">
            {{ heatmap | safe }}
        </div>
    </div>

</body>
</html>
